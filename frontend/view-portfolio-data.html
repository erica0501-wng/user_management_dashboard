<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Portfolio Data</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    .warning {
      background: #fff3cd;
      border: 1px solid #ffc107;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      color: #856404;
    }
    .section {
      margin: 30px 0;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #007bff;
    }
    h2 {
      color: #007bff;
      margin-top: 0;
    }
    pre {
      background: #282c34;
      color: #abb2bf;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 14px;
      line-height: 1.5;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }
    .stat-label {
      font-size: 14px;
      color: #666;
      margin-bottom: 5px;
    }
    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #333;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 10px 10px 0;
    }
    button:hover {
      background: #0056b3;
    }
    .export {
      background: #28a745;
    }
    .export:hover {
      background: #218838;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background: #f8f9fa;
      font-weight: 600;
      color: #333;
    }
    tr:hover {
      background: #f8f9fa;
    }
    .status-pending {
      color: #ffc107;
      font-weight: 600;
    }
    .status-filled {
      color: #28a745;
      font-weight: 600;
    }
    .status-cancelled {
      color: #6c757d;
      font-weight: 600;
    }
    .buy {
      color: #28a745;
      font-weight: 600;
    }
    .sell {
      color: #dc3545;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“Š Portfolio Data Viewer</h1>
    <p>æŸ¥çœ‹å­˜å‚¨åœ¨æµè§ˆå™¨ localStorage ä¸­çš„ Portfolio æ•°æ®</p>

    <div class="warning" id="warning">
      âš ï¸ å¦‚æœçœ‹ä¸åˆ°æ•°æ®ï¼Œè¯·ç¡®ä¿ï¼š
      <ol>
        <li>ä½ å·²ç»åœ¨åº”ç”¨ä¸­è¿›è¡Œè¿‡äº¤æ˜“</li>
        <li>ä½¿ç”¨ç›¸åŒçš„æµè§ˆå™¨æ‰“å¼€è¿™ä¸ªé¡µé¢</li>
        <li>åœ¨ç›¸åŒçš„åŸŸå/ç«¯å£ï¼ˆå¦‚æœä»æ–‡ä»¶æ‰“å¼€ï¼Œéœ€è¦å¤åˆ¶åˆ°åº”ç”¨ç›®å½•ï¼‰</li>
      </ol>
    </div>

    <button onclick="loadData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
    <button class="export" onclick="exportData()">ğŸ’¾ å¯¼å‡º JSON</button>
    <button class="export" onclick="clearData()">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</button>

    <div class="section">
      <h2>ğŸ’° è´¦æˆ·ä¿¡æ¯</h2>
      <div class="stats" id="accountStats">
        <div class="stat-card">
          <div class="stat-label">å¯ç”¨ç°é‡‘</div>
          <div class="stat-value" id="availableCash">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æŠ•èµ„é‡‘é¢</div>
          <div class="stat-value" id="totalInvested">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æ€»ä½™é¢</div>
          <div class="stat-value" id="totalBalance">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">è´­ä¹°åŠ› (2x)</div>
          <div class="stat-value" id="buyingPower">-</div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>ğŸ“‹ è®¢å•åˆ—è¡¨ (<span id="orderCount">0</span> ä¸ª)</h2>
      <div id="ordersTable"></div>
    </div>

    <div class="section">
      <h2>ğŸ“¦ æŒä»“ç»Ÿè®¡</h2>
      <div id="holdingsTable"></div>
    </div>

    <div class="section">
      <h2>ğŸ’» åŸå§‹æ•°æ® (JSON)</h2>
      <pre id="rawData">Loading...</pre>
    </div>
  </div>

  <script>
    function loadData() {
      // Get orders
      const ordersStr = localStorage.getItem('orders')
      const orders = ordersStr ? JSON.parse(ordersStr) : []

      // Get account balance
      const balanceStr = localStorage.getItem('accountBalance')
      const balance = balanceStr ? JSON.parse(balanceStr) : { availableCash: 0, totalInvested: 0 }

      // Update account stats
      document.getElementById('availableCash').textContent = `$${balance.availableCash.toLocaleString('en-US', {minimumFractionDigits: 2})}`
      document.getElementById('totalInvested').textContent = `$${balance.totalInvested.toLocaleString('en-US', {minimumFractionDigits: 2})}`
      const totalBalance = balance.availableCash + balance.totalInvested
      document.getElementById('totalBalance').textContent = `$${totalBalance.toLocaleString('en-US', {minimumFractionDigits: 2})}`
      const buyingPower = balance.availableCash * 2
      document.getElementById('buyingPower').textContent = `$${buyingPower.toLocaleString('en-US', {minimumFractionDigits: 2})}`

      // Update order count
      document.getElementById('orderCount').textContent = orders.length

      // Display orders table
      if (orders.length > 0) {
        let tableHtml = `
          <table>
            <thead>
              <tr>
                <th>çŠ¶æ€</th>
                <th>æ–¹å‘</th>
                <th>è‚¡ç¥¨</th>
                <th>åç§°</th>
                <th>ä»·æ ¼</th>
                <th>æ•°é‡</th>
                <th>æ€»é¢</th>
                <th>æ—¶é—´</th>
              </tr>
            </thead>
            <tbody>
        `
        orders.forEach(order => {
          const statusClass = order.status === 'Pending' ? 'status-pending' : 
                            order.status === 'Filled' ? 'status-filled' : 'status-cancelled'
          const directionClass = order.direction === 'Buy' ? 'buy' : 'sell'
          const total = (order.price * order.quantity).toFixed(2)
          
          tableHtml += `
            <tr>
              <td class="${statusClass}">${order.status}</td>
              <td class="${directionClass}">${order.direction}</td>
              <td><strong>${order.symbol}</strong></td>
              <td>${order.name || '-'}</td>
              <td>$${Number(order.price).toFixed(2)}</td>
              <td>${order.quantity}</td>
              <td>$${Number(total).toLocaleString()}</td>
              <td style="font-size: 12px;">${order.time}</td>
            </tr>
          `
        })
        tableHtml += '</tbody></table>'
        document.getElementById('ordersTable').innerHTML = tableHtml
      } else {
        document.getElementById('ordersTable').innerHTML = '<p style="color: #666;">æ²¡æœ‰è®¢å•æ•°æ®</p>'
      }

      // Calculate holdings
      const holdings = {}
      orders.filter(o => o.status === 'Filled').forEach(order => {
        if (!holdings[order.symbol]) {
          holdings[order.symbol] = { symbol: order.symbol, name: order.name, quantity: 0, avgPrice: 0, totalCost: 0 }
        }
        if (order.direction === 'Buy') {
          holdings[order.symbol].totalCost += order.price * order.quantity
          holdings[order.symbol].quantity += order.quantity
        } else {
          holdings[order.symbol].quantity -= order.quantity
        }
      })

      // Calculate average price
      Object.keys(holdings).forEach(symbol => {
        if (holdings[symbol].quantity > 0) {
          holdings[symbol].avgPrice = holdings[symbol].totalCost / holdings[symbol].quantity
        }
      })

      // Display holdings
      const holdingsArray = Object.values(holdings).filter(h => h.quantity > 0)
      if (holdingsArray.length > 0) {
        let holdingsHtml = `
          <table>
            <thead>
              <tr>
                <th>è‚¡ç¥¨</th>
                <th>åç§°</th>
                <th>æŒä»“æ•°é‡</th>
                <th>å¹³å‡æˆæœ¬</th>
                <th>æ€»æˆæœ¬</th>
              </tr>
            </thead>
            <tbody>
        `
        holdingsArray.forEach(holding => {
          holdingsHtml += `
            <tr>
              <td><strong>${holding.symbol}</strong></td>
              <td>${holding.name || '-'}</td>
              <td>${holding.quantity}</td>
              <td>$${holding.avgPrice.toFixed(2)}</td>
              <td>$${holding.totalCost.toFixed(2)}</td>
            </tr>
          `
        })
        holdingsHtml += '</tbody></table>'
        document.getElementById('holdingsTable').innerHTML = holdingsHtml
      } else {
        document.getElementById('holdingsTable').innerHTML = '<p style="color: #666;">æ²¡æœ‰æŒä»“</p>'
      }

      // Display raw JSON
      const rawData = {
        accountBalance: balance,
        orders: orders,
        holdings: holdingsArray
      }
      document.getElementById('rawData').textContent = JSON.stringify(rawData, null, 2)

      // Hide warning if data exists
      if (orders.length > 0) {
        document.getElementById('warning').style.display = 'none'
      }
    }

    function exportData() {
      const ordersStr = localStorage.getItem('orders')
      const balanceStr = localStorage.getItem('accountBalance')
      
      const data = {
        accountBalance: balanceStr ? JSON.parse(balanceStr) : null,
        orders: ordersStr ? JSON.parse(ordersStr) : []
      }

      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' })
      const url = URL.createObjectURL(blob)
      const a = document.createElement('a')
      a.href = url
      a.download = `portfolio-data-${new Date().toISOString().slice(0,10)}.json`
      a.click()
      URL.revokeObjectURL(url)
      alert('æ•°æ®å·²å¯¼å‡ºï¼')
    }

    function clearData() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ Portfolio æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
        localStorage.removeItem('orders')
        localStorage.removeItem('accountBalance')
        alert('æ•°æ®å·²æ¸…ç©ºï¼')
        loadData()
      }
    }

    // Load data on page load
    loadData()
  </script>
</body>
</html>
